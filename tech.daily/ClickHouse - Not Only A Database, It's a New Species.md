# ClickHouse - Not Only A Database, It's a New Species

- 按编写编程语言的方式来组织数据类型
- 将函数式计算模式引入select计算引擎

编程语言可以看做是(小规模)内存计算，数据库可以看做是(大规模)磁盘计算。但其本质上实际上是非常相似的，甚至在表观上可以做成完全一样的东西，但就是这么简单的东西，直到ClikcHouse做出来之后我们才注意到这个事实: 事实总是很简单，直到有人显而易见地将它指出来！
- 这个想法值得进一步挖掘
- 这个framework值得进一步探索

## SQL中的函数式编程
[古明地盆 - ClickHouse 数组的相关操作函数，一网打尽](https://www.cnblogs.com/traditional/p/15226704.html)

比如我们想要计算两个数组中相同位置的元素的差，那么就可以这么做：
```sql
-- 一个函数即可解决
SELECT arrayMap(x, y -> x - y, [1, 2, 3], [3, 2, 1]);
/*
┌─arrayMap(lambda(tuple(x, y), minus(x, y)), [1, 2, 3], [3, 2, 1])─┐
│ [-2,0,2]                                                         │
└──────────────────────────────────────────────────────────────────┘
*/
```
这已经是在函数式编程了，如果把select去掉或换成 `>>>` or `ghc >>>` 这实际上就是脚本语言的控制台！

[古明地盆 - ClickHouse 中的常用聚合函数](https://www.cnblogs.com/traditional/p/15228399.html)

如果想分组之后选择，选择每个组的第 N 大的值该怎么做呢？比如我们选择第 3 大的值。
```sql
-- 从小到大排个序即可，然后选择索引为 -3 的元素
-- 或者从大到小排个序，然后选择索引为 3 的元素
SELECT arraySort(groupArray(amount))[-2] rank3_1, arrayReverseSort(groupArray(amount))[2] rank3_2
FROM sales_data GROUP BY product, channel;
/*
┌─rank3_1─┬─rank3_2─┐
│    2784 │    2784 │
│    2804 │    2804 │
│    2650 │    2650 │
│    2856 │    2856 │
│    2865 │    2865 │
│    2610 │    2610 │
│    2632 │    2632 │
│    2754 │    2754 │
│    2694 │    2694 │
└─────────┴─────────┘
*/
```
确实给人一种 pandas 的感觉，之前做数据分析主要用 pandas。但是 pandas 有一个致命的问题，就是它要求数据能全部加载到内存中，所以在处理中小型数据集的时候确实很方便，但是对于大型数据集就无能为力了，只能另辟蹊径。但是 ClickHouse 则是通过分片机制支持分布式运算，所以个人觉得它简直就是分布式的 pandas。
